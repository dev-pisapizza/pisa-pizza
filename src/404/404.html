<script>
  const unknownUrl = window.location.href;
  const basePath = extractBasePath(unknownUrl);

  // e.g. `pizzas`
  const redirectUrl = `${basePath}?route=${extractPathAfterBasePath(unknownUrl, basePath)}`;

  /*
   * When the App is loaded, `src/app/app.component.ts` uses the `route` query
   * parameter to route to the destination using the angular router.
   */
  window.location = redirectUrl;

  function extractPathAfterBasePath(url, basePath) {
    const basePathUrl = new URL(basePath);
    const fullUrl = new URL(url);

    // Remove the basePath from the full URL to get the in-app route
    let inAppRoute = fullUrl.pathname.replace(basePathUrl.pathname, '');

    // Ensure the inAppRoute does not start with a leading slash for consistency
    if (inAppRoute.startsWith('/')) {
      inAppRoute = inAppRoute.substring(1);
    }

    return inAppRoute;
  }

  function extractBasePath(url) {
    const urlObj = new URL(url);
    const segments = urlObj.pathname.split('/').filter(Boolean); // Removes any empty strings from array

    // Determine the last relevant index for the base path
    const lastRelevantIndex = Math.max(segments.indexOf('develop'), segments.indexOf('pisa-pizza'));
    const basePathSegments = segments.slice(0, lastRelevantIndex + 1);

    // Construct the base path by including the protocol, host, and the relevant segments
    return `${urlObj.origin}/${basePathSegments.join('/')}`;
  }
</script>
